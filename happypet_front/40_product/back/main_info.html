<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>info</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <!-- 使用CDN引入bootstrap-icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- 後台header -->
    <link rel="stylesheet" href="../css/back_header_footer.css">
    <link rel="stylesheet" href="./css/main_info.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="../js/bootstrap.bundle.js"></script>
    <script src="../js/jquery-3.7.1.js"></script>
    <!-- <style>
        :root{
            --color-primary:#90b9ab;
            --color-secondary:#e4b0b4 ;
       
            --color-tertiary:#ffc971 ; 
        }
        body{
            background: url(../img/geometry.png);
            font-size: 1.2rem;
        }
        h2{
            color: #000;
        }
        .table>:not(caption)>*>* {
            padding: 1rem ;
        }
        input{
            width: 60%;
        }
        .table-striped>tbody>tr:nth-of-type(odd)>* {
            --bs-table-accent-bg:#cbe9dd;
        }
        
        input[type="file"]::file-selector-button,#inserBtn{
            background-color:var(--color-primary);
            color: #fff;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            box-sizing: border-box;
            border: 1px solid transparent;
            box-shadow: 2px 2px 3px #569682;
            font-weight: normal;
            letter-spacing: 1.5px;
            font-size: 1rem;
            transition: .2s;

        }
        input[type="file"]::file-selector-button:hover ,#inserBtn:hover{
            background-color:#a2c5ba;
            color: #ffffff;
            border: 1px solid var(--color-primary);
        }
        /*  */
        input[type="file"]::file-selector-button:active,#inserBtn:active{
            transform: scale(0.97);
        }
        #inserBtn{
            right: 0;
            line-height: 30px;
        }
        th{
            width: 20%;
        }
        #showDescImgs img ,#showCoverImg img,#showOthersImgs img{
            width: 50px;
            height: 50px;
            object-fit: cover;
        }
        input[name^="description"]{
            display: block;
            margin: 5px 0;
        }
        .descriptionInfo{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            background-color: #ffffff;
            width: 50%;
            box-shadow: 1px 2px 5px #ddd;
            border-radius: 30px;
            overflow: hidden;
        
        }
       
      
        .descriptionInfo img{
            width: 100%;
        }
        .descriptionInfo p{
            margin: 20px;
            background-color: rgb(255, 255, 255);
        }
        .bi-x-circle-fill{
            color: var(--color-primary);
            position: absolute;
            top: 3%;
            right: 3%;
            font-size: 2rem;
            cursor: pointer;
        }
        .bi-info-circle-fill{
            cursor: pointer;

        }
        .info_opacity{
            transition: .3s;
            opacity: 0;
        }
  
        .modal-footer{
            border: none;
        }
    </style> -->
</head>
<body>
    <header class="w-100 position-sticky">
        <div class="row m-0 px-md-5 text-center justify-content-lg-between justify-content-center align-items-center">
            <a href="" class="col-lg-3 col-8"><img class="img-fluid logo" src="../img/LOGO.png" alt=""></a>
            <ul class="nav col-lg-9 p-0 d-flex justify-content-lg-between justify-content-center">
                <li class="col-lg-2 col-3 dropdown">
                    <a href="" data-toggle="dropdown" class="dropdown-toggle" role="button" id="beauty"
                        data-bs-toggle="dropdown" aria-expanded="false">美容預約</a>
                    <ul class="dropdown-menu" aria-labelledby="beauty">
                        <li><a href="" class="dropdown-item">美容預約表</a></li>
                    </ul>
                </li>
                <li class="col-lg-2 col-3 dropdown">
                    <a href="" data-toggle="dropdown" class="dropdown-toggle" role="button" id="beauty"
                        data-bs-toggle="dropdown" aria-expanded="false">寵物住宿</a>
                    <ul class="dropdown-menu" aria-labelledby="beauty">
                        <li><a href="" class="dropdown-item">旅館訂單</a></li>
                        <li><a href="" class="dropdown-item">當日住宿</a></li>
                    </ul>
                </li>
                <li class="col-lg-2 col-3 dropdown">
                    <a href="" data-toggle="dropdown" class="dropdown-toggle" role="button" id="beauty"
                        data-bs-toggle="dropdown" aria-expanded="false">產品專區</a>
                    <ul class="dropdown-menu" aria-labelledby="beauty">
                        <li><a href="" class="dropdown-item">產品主要內容</a></li>
                        <li><a href="" class="dropdown-item">產品詳細資訊</a></li>
                        <li><a href="" class="dropdown-item">產品入庫</a></li>
                        <li><a href="" class="dropdown-item">上架中產品</a></li>
                        <li><a href="" class="dropdown-item">未上架產品</a></li>
                    </ul>
                </li>
                <li class="col-lg-2 col-3 dropdown">
                    <a href="" data-toggle="dropdown" class="dropdown-toggle" role="button" id="beauty"
                        data-bs-toggle="dropdown" aria-expanded="false">產品訂單</a>
                    <ul class="dropdown-menu" aria-labelledby="beauty">
                        <li><a href="" class="dropdown-item">美容預約表</a></li>
                    </ul>
                </li>
                <div class="nav_icon col-lg-2 ">
                    <a href="">登出</a>
                </div>
            </ul>
        </div>
    </header>
    <!-- <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
          <button class="nav-link active ms-auto" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">新增</button>
          <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">修改</button>
        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active " id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
            11111111111111111111

        </div>
        <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">2222</div>
    </div> -->
    <!--  ---------------------- 不可以改 ---------------------- -->
    <div class="container-md  py-3 px-5">
        <h2 class="m-0 py-3">產品主要資訊</h2>
        <form id="pdInfo" method="post" enctype="multipart/form-data" class="position-relative">
            <table class="table  table-striped align-middle">
                <tbody>
                    <tr>
                        <th scope="row">產品類別</th>
                        <td>
                            <select name="category" id="categoryOptions" >
                                <option value="">請選擇類別</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">產品系列編號</th>
                        <td><input type="text" name="pdSeries" id="pdSeries"></td>
                    </tr>
                    <tr>
                        <th scope="row">產品系列名稱</th>
                        <td><input type="text" name="pdName" id="pdName" ></td>
                    </tr>
                    <tr>
                        <th scope="row">產品封面圖(一張)</th>
                        <td><input type="file" name="coverimg" id="coverimg" >
                            <div id="showCoverImg"></div>
                        </td>
                        <!-- 1是cover 2是thumbnail 3是description -->
                    </tr>
                    <tr>
                        <th scope="row">產品其他圖片(最多8張)</th>
                        <td >
                            <input type="file" name="imgs[]" id="othersImgs"  multiple >
                            <div id="showOthersImgs"></div>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">產品敘述圖片</th>
                        <td >
                            <input type="file" name="descimgs[]" id="descimgs" multiple >
                            <div id="showDescImgs"></div>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">敘述 <i class="bi bi-info-circle-fill"></i></th>
                        <td ><input id="description" name="description1" placeholder="請至少輸入一條敘述">
                        <input name="description2">
                        <input name="description3">
                        <input name="description4">
                        <input name="description5">
                        </td>
                    </tr>
                </tbody>
            </table>
            <button id="inserBtn" class="position-absolute " >建立產品系列</button>
        </form>
    </div>
    <!--  ---------------------- 不可以改 ---------------------- -->

    <div class="descriptionInfo d-none">
        <p class="p-3 m-3 mb-0" >說明：敘述會顯示在前臺紅框區，可輸入五條敘述。</p>
        <img class="p-3 " src="../img/description.jpg" alt="敘述說明圖">
        <i class="bi bi-x-circle-fill"></i>
    </div>
    <!-- 彈出視窗 -->
    <!-- Modal -->
    <div class="modal fade " id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <p id="alertMsg" class="m-0"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" data-bs-dismiss="modal">確認</button>
            </div>
        </div>
        </div>
    </div>
  
    <!-- <img  src="" alt=""> -->
    <script>
        let inserBtn = document.getElementById('inserBtn')
        window.onload = ()=>{
            let myModal = document.getElementById('myModal')
            let myInput = document.getElementById('myInput')
            // let infoBtn = document.querySelector('.bi-info-circle-fill')
            myModal.addEventListener('shown.bs.modal', function () {
                myInput.focus()
            })
            function showMsg(msg){
                $('#myModal').modal('show')
                $('#alertMsg').text(msg)
            }
            $('.bi-info-circle-fill').click(()=>{
                $(".descriptionInfo").removeClass('d-none');
            })
            $('.bi-x-circle-fill').click(()=>{
                $(".descriptionInfo").addClass('d-none');
            })
            // $('.bi-info-circle-fill').hover(function(){
            //     // $(".descriptionInfo").removeClass('info_opacity');
            //     $(".descriptionInfo").removeClass('d-none');
            // },function(){
            //     // $("p").css("background-color","pink");
            //     // $(".descriptionInfo").addClass('info_opacity');
            //     $(".descriptionInfo").addClass('d-none');

            // });
            // coverimg.onchange = ()=>{
            //     // let coverIMG = coverimg
            //     console.log('我是封面圖',coverimg.files)
            //     console.log('我是封面圖',coverimg.files[0])
            //     let imgreader = new FileReader();
            //     imgreader.readAsDataURL(coverimg.files[0])
            //     imgreader.onload = (event)=>{
            //         console.log('eee',event) 
            //         // src在event裡面的target的result
            //         showImg.innerHTML += `<img src="${event.target.result}">`
            //     }
            // }
            pdSeries.onchange = ()=>{
                let formData = new FormData(document.getElementById('pdInfo'));
                // formData.append('action', 'fetch');
                // fetch('infoupload.php',{
                console.log('event.target.value',event.target.value)
                fetch(`http://localhost/testpet/public/product_back/info/select/${event.target.value}`,{
                    method:'get',
                    // body:formData
                })
                .then(response=>{
                    // console.log(response)
                    // return response.json()
                    return response.json()
                })
                .then(({message,categories})=>{
                    console.log('message = ',message.message)
                    // let {message,data} = data
                    showMsg(message.message)
                })
            }
            coverimg.onchange = ()=>{
                let imgreader = new FileReader();
                // console.log('imgreader',imgreader)
                imgreader.readAsDataURL(coverimg.files[0])
                showCoverImg.innerHTML = ''
                imgreader.onload = (event)=>{
                    // console.log('eee',event) 
                    // src在event裡面的target的result
                    showCoverImg.innerHTML += `<img src="${event.target.result}">`
                }
                
                // console.log('我是封面圖',descimgs.files[0])
            }
            descimgs.onchange = ()=>{
                // console.log('我是敘述圖',descimgs.files)
                let descIMGs = Array.from(descimgs.files); // 轉換為陣列
                descIMGs.forEach((img)=>{
                    // console.log('我是敘述圖單張',img)
                    let imgreader = new FileReader();
                    imgreader.readAsDataURL(img)
                    showDescImgs.innerHTML = ''
                    imgreader.onload = (event)=>{
                        // console.log('eee',event) 
                        // src在event裡面的target的result
                        showDescImgs.innerHTML += `<img src="${event.target.result}">`
                    }
                })
                // console.log('我是封面圖',descimgs.files[0])
            }
            othersImgs.onchange = ()=>{
                let othersIMGs = Array.from(othersImgs.files); // 轉換為陣列
                othersIMGs.forEach((img)=>{
                    let imgreader = new FileReader();
                    imgreader.readAsDataURL(img)
                    showOthersImgs.innerHTML = ''
                    imgreader.onload = (event)=>{
                        // console.log('eee',event) 
                        // src在event裡面的target的result
                        showOthersImgs.innerHTML += `<img src="${event.target.result}">`
                    }
                })
                // console.log('我是封面圖',descimgs.files[0])
            }

            // fetch('category.php',{
            // fetch('http://localhost/testpet/public/product_back/info/select',{
            fetch('http://localhost/testpet/public/api/product_back/info/select',{
                    method:'get',
            })
            .then(response=>{
                // console.log(response)
                // return response.text()
                return response.json()
            })
            .then(({categories})=>{
                // alert(data)
                console.log('我是options',categories)
                categories.forEach((category) => {   //多張照片遍歷
                    // console.log('category = ', category)
                    // console.log('我是index',index)
                    // console.log(category.split('-'))  //分割後取英文([0])
                    categoryOptions.innerHTML += `<option value="${category.split('-')[0]}">${category}</option>`
                });
            })


            inserBtn.onclick = (event)=>{
                event.preventDefault();
                let formData = new FormData(document.getElementById('pdInfo'));
                formData.append('action', 'insert');
                // fetch('infoupload.php',{
                //     method:'post',
                //     body:formData
                // })
                fetch('http://localhost/testpet/public/api/product_back/info/create',{
                    method:'post',
                    body:formData
                })
                .then(response=>{
                    if (!response.ok) {
                        throw new Error(`伺服器錯誤: ${response.statusText}`);
                    }
                    // console.log(response)
                    // return response.text()
                    return response.json()
                })
                .then(data=>{
                    // alert(data)
                    console.log('我是data1',data)

                    // let parsedData = JSON.parse(data)
                    // console.log('我是data2',data)
                    console.log('parsedData',data)
                    if (data.message) {
                        console.log(data.message);
                        showMsg(data.message)
                        setTimeout(()=>{
                            location.reload()// 刷新頁面
                        },1000)
                    } else if (data.error) {
                        showMsg(data.error)
                       

                    }
                    // if (parsedData.message) {
                    //     console.log(parsedData.message);
                    //     showMsg(parsedData.message)
                    //     // alert(parsedData.message)
                    //     setTimeout(()=>{
                    //         location.reload()// 刷新頁面
                    //     },1000)
                    // } else if (parsedData.error) {
                    //     // console.log('Error:', parsedData.error);
                    //     showMsg(parsedData.error)
                    //     // alert(parsedData.error)

                    // }
                })
            }
        }
    </script>
</body>
</html>